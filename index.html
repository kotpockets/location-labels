<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tally Location Label Maker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    padding: 16px;
    margin: 0;
    background: #f5f5f5;
  }
  .container {
    max-width: 520px;
    margin: 0 auto;
    background: #fff;
    padding: 14px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  }
  h2 {
    font-size: 20px;
    text-align: center;
    margin: 0 0 12px;
  }
  .field {
    margin-bottom: 10px;
  }
  label {
    font-size: 13px;
    font-weight: 600;
    display: block;
    margin-bottom: 3px;
  }
  input {
    width: 100%;
    padding: 9px 10px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  .buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 8px;
  }
  button {
    padding: 12px;
    font-size: 17px;
    border-radius: 999px;
    border: none;
  }
  button.primary {
    background: #111;
    color: #fff;
  }
  button.secondary {
    background: #eee;
    color: #111;
    border: 1px solid #ccc;
  }
  #labelCanvas {
    width: 100%;
    max-width: 100%;
    display: block;
    margin: 14px auto 4px;
    border-radius: 8px;
    background: #fff;
    border: 1px solid #ddd;
  }
  .hint {
    font-size: 11px;
    text-align: center;
    color: #666;
  }
</style>
</head>
<body>

<div class="container">
  <h2>Location Label Maker (2×4)</h2>

  <div class="field">
    <label for="zone">Zone</label>
    <input id="zone" inputmode="numeric" autocomplete="off">
  </div>
  <div class="field">
    <label for="dept">Dept</label>
    <input id="dept" autocomplete="off">
  </div>
  <div class="field">
    <label for="aisle">Aisle</label>
    <input id="aisle" autocomplete="off">
  </div>
  <div class="field">
    <label for="side">Side</label>
    <input id="side" autocomplete="off">
  </div>
  <div class="field">
    <label for="seg">Seg</label>
    <input id="seg" inputmode="numeric" autocomplete="off">
  </div>

  <div class="buttons">
    <button class="primary" onclick="updatePreview()">Update Preview</button>
    <button class="secondary" onclick="downloadPng()">Download PNG</button>
  </div>

  <canvas id="labelCanvas" width="1200" height="600"></canvas>
  <div class="hint">
    PNG is 1200×600 for sharp 2×4 label printing. Blank fields are skipped in text & QR.
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
function buildQrText(parts) {
  return parts
    .map(x => x.trim())
    .filter(x => x.length > 0)
    .map(x => x.toUpperCase())
    .join("-");
}

function drawDarkText(ctx, text, x, y) {
  // Font is set outside; this just makes it dark and heavy
  ctx.lineWidth = 2;
  ctx.strokeStyle = "#000000";
  ctx.strokeText(text, x, y);
  ctx.fillStyle = "#000000";
  ctx.fillText(text, x, y);
}

function updatePreview() {
  const fields = {
    Zone:  document.getElementById('zone').value,
    Dept:  document.getElementById('dept').value,
    Aisle: document.getElementById('aisle').value,
    Side:  document.getElementById('side').value,
    Seg:   document.getElementById('seg').value
  };

  const qrText = buildQrText([
    fields.Zone,
    fields.Dept,
    fields.Aisle,
    fields.Side,
    fields.Seg
  ]) || " ";

  const canvas = document.getElementById("labelCanvas");
  const ctx = canvas.getContext("2d");

  // Clear background
  ctx.fillStyle = "#FFFFFF";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // --- TEXT BLOCK: 56px Arial, auto-spaced between QR top & bottom ---
  const qrTop = 110;
  const qrSize = 380;
  const qrBottom = qrTop + qrSize;

  const fontSize = 56;
  ctx.font = fontSize + 'px Arial, sans-serif';

  const left = 90;

  const nonEmpty = Object.entries(fields)
    .filter(([_, v]) => v.trim().length > 0);

  const lineCount = nonEmpty.length;

  if (lineCount > 0) {
    if (lineCount === 1) {
      // Center single line vertically in QR area
      const center = (qrTop + qrBottom) / 2;
      const baseline = center + fontSize / 2 - 4;
      const [label, val] = nonEmpty[0];
      const text = `${label.padEnd(4)} ${val.toUpperCase()}`;
      drawDarkText(ctx, text, left, Math.round(baseline));
    } else {
      // First baseline near top, last near bottom, equal spacing
      const topPadding = 8;
      const bottomPadding = 8;

      const firstBaseline = qrTop + topPadding + fontSize;
      const lastBaseline  = qrBottom - bottomPadding;

      const totalSpan = lastBaseline - firstBaseline;
      const lineStep = totalSpan / (lineCount - 1);

      let y = firstBaseline;
      for (const [label, val] of nonEmpty) {
        const text = `${label.padEnd(4)} ${val.toUpperCase()}`;
        drawDarkText(ctx, text, left, Math.round(y));
        y += lineStep;
      }
    }
  }

  // --- QR code on the right ---
  const temp = document.createElement("div");
  temp.style.position = "absolute";
  temp.style.left = "-9999px";
  document.body.appendChild(temp);

  const qrSizePx = 380;

  new QRCode(temp, {
    text: qrText,
    width: qrSizePx,
    height: qrSizePx,
    correctLevel: QRCode.CorrectLevel.L
  });

  setTimeout(() => {
    const img = temp.querySelector("img") || temp.querySelector("canvas");
    if (img) {
      const qrX = 720;
      const qrY = 110;
      ctx.drawImage(img, qrX, qrY, qrSizePx, qrSizePx);
    }
    temp.remove();
  }, 80);
}

function downloadPng() {
  const canvas = document.getElementById("labelCanvas");
  const link = document.createElement("a");
  link.href = canvas.toDataURL("image/png");
  link.download = "location-label.png";
  link.click();
}

// Draw initial preview
updatePreview();
</script>

</body>
</html>
